<!doctype html>
<html lang="en" bs-theme="auto">
  <head>
        <title>Jack's Blog - The struggles of building a Feed Reader</title>
      <meta charset="utf-8" />
      <meta name="generator" content="Pelican" />
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type="text/css" href="https://jackevansevo.github.io/theme/css/pygments.css" />
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <link rel="shortcut icon" type="image/x-icon" href="https://jackevansevo.github.io/theme/favicon.ico">
      <script src="https://cdn.counter.dev/script.js" data-id="91e2f16c-845b-4d6d-95f5-ec7838cee876" data-utcoffset="-3"></script>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Signika+Negative:wght@300..700&display=swap" rel="stylesheet">
<style>
main {
	font-family: "Signika Negative" !important;
	font-weight: 300;
}
</style>

        <link href="https://jackevansevo.github.io/index.xml" type="application/atom+xml" rel="alternate" title="Jack's Blog Full Atom Feed" />
  <style>
    .content {
      display: block;
      margin-left: auto;
      margin-right: auto;
      max-width: 800px;
    }
  </style>


  <style>
    article > h2, h3, h4, h5 {
      padding: 1rem 0;
    }
    article > div.highlight > pre {
      border: solid 0.1rem; rgb(33, 37, 41);
      background-color: #fdf6e3;
      padding: 0.5rem;
      border-radius: 0.4rem;
    }
  </style>



    <meta name="tags" content="Python" />
    <meta name="tags" content="RSS" />

    <script>
/*!
 * Color mode toggler for Bootstrap's docs (https://getbootstrap.com/)
 * Copyright 2011-2023 The Bootstrap Authors
 * Licensed under the Creative Commons Attribution 3.0 Unported License.
 */

      (() => {
        'use strict'

        const getStoredTheme = () => localStorage.getItem('theme')
        const setStoredTheme = theme => localStorage.setItem('theme', theme)

        const getPreferredTheme = () => {
          const storedTheme = getStoredTheme()
          if (storedTheme) {
            return storedTheme
          }

          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        const setTheme = theme => {
          if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.setAttribute('data-bs-theme', 'dark')
          } else {
            document.documentElement.setAttribute('data-bs-theme', theme)
          }
        }

        setTheme(getPreferredTheme())

        const showActiveTheme = (theme, focus = false) => {
          const themeSwitcher = document.querySelector('#bd-theme')

          if (!themeSwitcher) {
            return
          }

          const themeSwitcherText = document.querySelector('#bd-theme-text')
          const activeThemeIcon = document.querySelector('.theme-icon-active use')
          const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
          const svgOfActiveBtn = btnToActive.querySelector('svg use').getAttribute('href')

          document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
            element.classList.remove('active')
            element.setAttribute('aria-pressed', 'false')
          })

          btnToActive.classList.add('active')
          btnToActive.setAttribute('aria-pressed', 'true')
          activeThemeIcon.setAttribute('href', svgOfActiveBtn)
          const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`
          themeSwitcher.setAttribute('aria-label', themeSwitcherLabel)

          if (focus) {
            themeSwitcher.focus()
          }
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          const storedTheme = getStoredTheme()
          if (storedTheme !== 'light' && storedTheme !== 'dark') {
            setTheme(getPreferredTheme())
          }
        })

        window.addEventListener('DOMContentLoaded', () => {
          showActiveTheme(getPreferredTheme())

          document.querySelectorAll('[data-bs-theme-value]')
            .forEach(toggle => {
              toggle.addEventListener('click', () => {
                const theme = toggle.getAttribute('data-bs-theme-value')
                setStoredTheme(theme)
                setTheme(theme)
                showActiveTheme(theme, true)
              })
            })
        })
      })()
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="https://jackevansevo.github.io/">Jack's Blog</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/"><i class="bi bi-house-fill"></i>&nbsp;&nbsp;Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="https://jackevansevo.github.io/index.xml"><i class="bi bi-rss-fill"></i>&nbsp;&nbsp;Feed</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="https://twitter.com/Thisisjackevans"><i class="bi bi-twitter"></i>&nbsp;&nbsp;Twitter</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="https://fosstodon.org/@JackEvans"><i class="bi bi-mastodon"></i>&nbsp;&nbsp;Mastodon</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="https://www.youtube.com/channel/UC4yxFC8_z8-DeYLeHXKtdHg"><i class="bi bi-youtube"></i>&nbsp;&nbsp;Youtube</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="https://docs.google.com/document/d/e/2PACX-1vRHykkB3oIRnf7HkA6jlb_p_g47D0WPapwppQxyyss9AzXlLHqZTAT8qD0xnG7E6qSk7sNpF3GfdQdm/pub"><i class="bi bi-pen-fill"></i>&nbsp;&nbsp;Resume</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main>
      <div class="container p-lg-5 p-3">
<div class="content">
  <h1>
    <a href="https://jackevansevo.github.io/the-struggles-of-building-a-feed-reader.html" rel="bookmark" class="link-underline link-underline-opacity-0 link-underline-opacity-75-hover" title="Permalink to The struggles of building a Feed Reader">The struggles of building a Feed Reader</a>
  </h1>
  <header>
    
  </header>
  <footer>
    <time datetime="2022-10-05T00:00:00+01:00">
	    <i class="bi bi-clock"></i><b>Published:</b> Wed 05 October 2022
    </time>
<div>
<i class="bi bi-tags"></i>&nbsp;<b>Tags</b>:
  <a href="https://jackevansevo.github.io/tag/python.html"><span class="badge text-bg-warning">Python</span></a>
  <a href="https://jackevansevo.github.io/tag/rss.html"><span class="badge text-bg-secondary">RSS</span></a>
</div>
  </footer><!-- /.post-info -->
  <hr>
  <article>
    <p><img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/43/Feed-icon.svg/1200px-Feed-icon.svg.png" style="width:18%;"></p>
<p>I recently I fell down the rabbit hole of building a
<a href="https://github.com/Jackevansevo/feedreader">feedreader</a>. At the time I was
unsatisfied with the free tier offering of tools like inoreader and feedly, so
naturally I figured I'd try and build my own, after all, how hard could it be?</p>
<p><strong>Aside:</strong> This was well before discovering <a href="https://miniflux.app/">miniflux</a>,
which is a fantastic piece of software. I've since decommissioned <a href="https://github.com/Jackevansevo/feedreader">my own
attempt</a> and now happily self host
my own miniflux instance instead.</p>
<hr>
<p>Here's a non exhaustive list of issues I've encountered along the way.</p>
<h2>1. Atom vs RSS</h2>
<p>I'll start with perhaps the most obvious...</p>
<p>There's multiple different competing standards to subscribe to represent web
feeds. Each with it's own specification, quirks and features.</p>
<p>Thankfully there's a sufficient amount of overlap between specifications that
it's possible to store data in a consistent normalised format. However doing so
isn't always straightforward.</p>
<p>One of the first challenges I faced when ingesting data from different formats
was designing a consistent normalised representation. I wanted a single <code>feed</code>
table to handle data from both atom/rss feeds.</p>
<p>Here's a comparison table I grabbed from the Wikipedia page for <a href="https://en.wikipedia.org/wiki/RSS#RSS_compared_with_Atom">RSS compared
with Atom</a> which
lists all the equivalent elements.</p>
<table class="table table-striped table-hover table-sm">
<thead>
<tr>
<th>RSS 2.0</th>
<th>Atom 1.0</th>
</tr>
</thead>
<tbody>
<tr>
<td>author</td>
<td>author*</td>
</tr>
<tr>
<td>category</td>
<td>category</td>
</tr>
<tr>
<td>channel</td>
<td>feed</td>
</tr>
<tr>
<td>copyright</td>
<td>rights</td>
</tr>
<tr>
<td>—</td>
<td>subtitle</td>
</tr>
<tr>
<td>description*</td>
<td>summary and/or content</td>
</tr>
<tr>
<td>generator</td>
<td>generator</td>
</tr>
<tr>
<td>guid</td>
<td>id*</td>
</tr>
<tr>
<td>image</td>
<td>logo</td>
</tr>
<tr>
<td>item</td>
<td>entry</td>
</tr>
<tr>
<td>lastBuildDate (in channel)</td>
<td>updated*</td>
</tr>
<tr>
<td>link*</td>
<td>link*</td>
</tr>
<tr>
<td>managingEditor</td>
<td>author or contributor</td>
</tr>
<tr>
<td>pubDate</td>
<td>published (subelement of entry)</td>
</tr>
<tr>
<td>title*</td>
<td>title*</td>
</tr>
<tr>
<td>ttl</td>
<td>—</td>
</tr>
</tbody>
</table>

<p>An RSS feed has a <code>description</code> whereas an Atom feed has a <code>subtitle</code>. If
you wanted to store this information as a generic 'feed' representation what
would you name this column?</p>
<p>In this instance the choice of name for the internal representation doesn't
particularly matter as both fields are equivalent.</p>
<p>But what about fields that are available in one specification that aren't
available in another? Where would you store this data?</p>
<p>If you're lucky, your language of choice might have some decent open source
libraries to parse these feeds and return a abstract/normalised 'feed' for you.
If not: writing a parser for these from scratch can be a bit tedious.</p>
<p>I started off using a great library called
<a href="https://pypi.org/project/feedparser/">feedparser</a>, which I found to be super
simple and robust (shoutout to the maintainers 👏). This which was excellent
for building a prototype, but further along in development I decided to
experiment with writing my own from scratch.</p>
<p>I was quickly able to parse a bulk of feeds that I subscribe to, but ran into a
few edge cases which required defensive code. The parser itself is still very
brittle. This gave me a real appreciation for libraries like feedparser and all
the corner cases they're able to handle.</p>
<h2>2. Finding Feed Links (Inconsistent conventions)</h2>
<p>Lets say I come across a site <code>example.com</code> which I'd like to subscribe to via
RSS/Atom. How do I find the feed URL?</p>
<p>Typically I'll try and look for an RSS link/icon on the page itself and copy
this value and paste into my feed reader of choice. Or I'll inspect the page
source and hunt down the link by CTRL+F searching for different patterns.</p>
<p><img alt="RSS Inspecting Page Source" src="https://jackevansevo.github.io/images/rss-inspect-element.png" title="Viewing the page source to find RSS links"></p>
<p>So far I've come across the following common patterns:</p>
<ul>
<li><code>example.com/rss.xml</code></li>
<li><code>example.com/index.xml</code></li>
<li><code>example.com/feed.xml</code></li>
<li><code>example.com/atom.xml</code></li>
<li><code>example.com/feed</code></li>
<li><code>example.com/rss</code></li>
</ul>
<h3>The problem with automating this approach</h3>
<p>In an ideal world I'd like users to be able to just subscribe to <code>example.com</code>
without having to manually find this link. How would you go about doing this?</p>
<p>There's a few steps I can think of</p>
<h4>Strategy 1.</h4>
<p>You could scrape <code>example.com</code> and search for something like:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Example&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/rss.xml&quot;</span><span class="p">&gt;</span>
</code></pre></div>

<p>Not all sites include a link to the RSS feed in the site <code>meta</code> (Occasionally
you have to parse the HTML body).</p>
<h4>Strategy 2.</h4>
<p>If this fails you could naively fall back to scraping common patterns, i.e:
<code>/rss.xml | /index.xml</code>  to see if any of these pages exist and then parse the
first result.</p>
<h4>Strategy 3.</h4>
<p>Or you could not bother at all and leave it up to the end user to be explicit
about what feed they wish to subscribe to.</p>
<h2>3. Finding Entry Links</h2>
<p>Some Atom feed links might contain <code>&lt;link rel="alternate" type="text/html"&gt;</code>
indicating this is very likely the link to the underlying item/entry (not some
other external link).</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;entry&gt;</span>
<span class="nt">&lt;title&gt;</span>2021-03-28<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;alternate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/html&quot;</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://www.suckless.org/#2021-03-28&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;id&gt;</span>https://www.suckless.org/#2021-03-28T00:00Z<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;updated&gt;</span>2021-03-28T00:00Z<span class="nt">&lt;/updated&gt;</span>
<span class="nt">&lt;published&gt;</span>2021-03-28T00:00Z<span class="nt">&lt;/published&gt;</span>
<span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;p&gt;</span>On<span class="w"> </span>Wednesday,<span class="w"> </span>2021-03-31<span class="w"> </span>there<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>scheduled<span class="w"> </span>maintenance<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>suckless<span class="w"> </span>servers.<span class="w"> </span>It&#39;s<span class="w"> </span>estimated<span class="w"> </span>this<span class="w"> </span>will<span class="w"> </span>take<span class="w"> </span>about<span class="w"> </span>2-3<span class="w"> </span>hours<span class="w"> </span>from<span class="w"> </span>about<span class="w"> </span>19:00<span class="w"> </span>to<span class="w"> </span>21:00<span class="w"> </span>-<span class="w"> </span>22:00<span class="w"> </span>UTC+02:00.<span class="nt">&lt;/p&gt;</span><span class="w"> </span><span class="nt">&lt;p&gt;</span>The<span class="w"> </span>mailinglist,<span class="w"> </span>website<span class="w"> </span>and<span class="w"> </span>source-code<span class="w"> </span>repositories<span class="w"> </span>will<span class="w"> </span>have<span class="w"> </span>some<span class="w"> </span>downtime.<span class="nt">&lt;/p&gt;</span><span class="w"> </span><span class="nt">&lt;p&gt;&lt;strong&gt;</span>Update:<span class="nt">&lt;/strong&gt;</span><span class="w"> </span>the<span class="w"> </span>maintenance<span class="w"> </span>was<span class="w"> </span>finished<span class="w"> </span>at<span class="w"> </span>2021-03-31<span class="w"> </span>19:10<span class="w"> </span>UTC+02:00.<span class="w"> </span>Please<span class="w"> </span>let<span class="w"> </span>us<span class="w"> </span>know<span class="w"> </span>if<span class="w"> </span>there<span class="w"> </span>are<span class="w"> </span>issues.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
</code></pre></div>

<p>Some Atom feeds just contain a <code>&lt;link href=""&gt;</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;entry&gt;</span>
<span class="w">  </span><span class="nt">&lt;title&gt;</span>
<span class="w">    </span>Finding<span class="w"> </span>performance<span class="w"> </span>problems:<span class="w"> </span>profiling<span class="w"> </span>or<span class="w"> </span>logging?
<span class="w">  </span><span class="nt">&lt;/title&gt;</span>
<span class="w">  </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://pythonspeed.com/articles/logging-vs-profiling/&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;updated&gt;</span>2022-08-09T00:00:00+00:00<span class="nt">&lt;/updated&gt;</span>
<span class="w">  </span><span class="nt">&lt;id&gt;</span>
<span class="w">    </span>https://pythonspeed.com/articles/logging-vs-profiling
<span class="w">  </span><span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
</code></pre></div>

<p>Some feed might contain a combination of both!</p>
<p>All this can make it tricky when finding the 'right' link for a particular
entry/item.</p>
<p>For example here's some (pretty naive) parsing logic I have in my Atom parser to
find the 'best' link for each entry:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">et</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nsmap</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="c1"># Return the best matching link</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;alternate&quot;</span> <span class="ow">and</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;alternate&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span> <span class="ow">or</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;hub&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">href</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">link</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<h2>4. Published vs Updated</h2>
<p>An entry might have <code>updated</code> but not published. If you weren't lucky enough to
scrape/fetch the feed when the entry contained <code>published</code> you'll never know.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;entry&gt;</span>
<span class="w">  </span><span class="nt">&lt;title&gt;</span>
<span class="w">    </span>Blah<span class="w"> </span>Blah<span class="w"> </span>Blah
<span class="w">  </span><span class="nt">&lt;/title&gt;</span>
<span class="w">  </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://example.com/articles/example/&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;updated&gt;</span>2022-08-09T00:00:00+00:00<span class="nt">&lt;/updated&gt;</span>
<span class="w">  </span><span class="nt">&lt;content</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="w"> </span><span class="na">xml:base=</span><span class="s">&quot;https://example.com/articles/example/&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>Blah<span class="w"> </span>Blah<span class="w"> </span>Blah
<span class="w">  </span><span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
</code></pre></div>

<p>In my feedreader backend I had to include the following default behaviour:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">published</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">updated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Just for sorting</span>
    <span class="n">published</span> <span class="o">=</span> <span class="n">updated</span>
</code></pre></div>

<h2>5. Description vs Content</h2>
<p>The description field is intended to be a little snippet/preview of the article/entry itself.</p>
<p>Then the bulk of the article should end up in <code>content</code> itself.</p>
<p>Of course in practice that's not how it works.</p>
<p>Some feeds store the entire article body in <code>description</code> and don't have an empty <code>content</code></p>
<p>Some feeds completely duplicate the article content across both <code>description</code> and <code>content</code></p>
<p>I attempt to handle these scenarios with something like:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">summary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">summary</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">elif</span> <span class="n">summary</span> <span class="o">==</span> <span class="n">content</span><span class="p">:</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

<p>Some feeds have an empty <code>description</code> and only serve <code>content</code>. To resolve
this this I opt to show a preview of the article content in place of the
missing description.</p>
<div class="highlight"><pre><span></span><code><span class="cp">{%</span> <span class="k">if</span> <span class="nv">entry.summary</span> <span class="cp">%}</span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">entry.summary</span><span class="o">|</span><span class="nf">truncatewords</span><span class="o">:</span><span class="m">50</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">elif</span> <span class="nv">entry.content</span> <span class="cp">%}</span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">entry.content</span><span class="o">|</span><span class="nf">truncatewords</span><span class="o">:</span><span class="m">50</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</code></pre></div>

<p>Sometimes the entry can just be completely devoid of any information, I've encountered feeds like:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;entry&gt;</span>
<span class="w">  </span><span class="nt">&lt;title/&gt;</span>
<span class="w">  </span><span class="nt">&lt;id/&gt;</span>
<span class="w">  </span><span class="nt">&lt;updated&gt;</span>0001-01-01T00:00:00Z<span class="nt">&lt;/updated&gt;</span>
<span class="w">  </span><span class="nt">&lt;content/&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
</code></pre></div>

<p>Some feeds only serve up the <code>description</code> and have a blank <code>content</code>, forcing
users to link through to read the article on the original site (semi defeating
the point of subscribing via  feedreader)</p>
<p>If you're writing any parser that attempts to ingest feed data you'll need
robust and resilient parsing logic to handle all these different edge cases or
recover from failures when you hit an unknown problem.</p>
<h2>6. Datetime fields not timezone aware</h2>
<p>Many feeds include timestamps that don't include any timezone information. It's
still unclear to me how to best handle this case.</p>
<p>In practice this might lead to bogus <code>published</code> or <code>updated</code> values because
the author is in a different timezone to you.</p>
<p>I.e. what happens if the Author is in a future timezone and they publish a post 5 hours ahead?</p>
<p>I opted not showing posts with published dates in the future, but this feels
like a compromise.</p>
<h2>7. DB Size Constraints</h2>
<p>Because the RSS and Atom feeds are pretty loose specs, they don't (to my
knowledge) impose any size constraints on field contents.</p>
<p>This can be an issue if you're hosting a service on the world wide web that let
users enter data. This arbitrarity means you're going to have to make some of
these decisions yourself (for me some of these decisions were wrong).</p>
<p>If you're planning on scraping feeds/entries and saving the contents to your
database there're some key things to consider:
- What's the max length a feed/entry title/subtitle?
- How much content are you willing to store?
- What happens when you encounter a field bigger than the max size?</p>
<p>Early on I added constraints to my DB layer thinking I had sensible limits that
would never be exceeded. But frequently ran into exceptions for perfectly valid
feeds forcing me to re-evaluate and bump max limit</p>
<p>At some point however there might be a cut-off after which you want to reject
content beyond a certain size threshold.</p>
<h2>8. Attempting to slugify resources</h2>
<p>I wanted nice links internal to my site, i.e. if you subscribed to:</p>
<p>https://overreacted.io/rss.xml</p>
<p>Which has a Feed title of <code>Dan Abramov's Overreacted Blog RSS Feed</code></p>
<p>I wanted the URL for this feed to be:</p>
<ul>
<li><code>/feed/dan-abramovs-overreacted-blog-rss-feed/</code></li>
</ul>
<p>This turned out to be a bit of a mistake because not every feed title is
guaranteed to be something you can slugify.</p>
<p>As an example I came across http://benyu.org/feed</p>
<p>Which has the title: <code>&lt;title&gt;-… — —&lt;/title&gt;</code></p>
<p>Good lucky trying to slugify that 🤦</p>
<h3>Better Solution</h3>
<p>Feedly, inoreader and miniflux wisely completely sidestep this problem by instead just URL encoding the feed URL, i.e.</p>
<p>https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Foverreacted.io%2Frss.xml</p>
<p>https://www.inoreader.com/feed/https%3A%2F%2Foverreacted.io%2Frss.xml</p>
<p>In hindsight I should have done the same.</p>
<h2>9. Relative vs Absolute Links</h2>
<p>Most feeds are pretty good about this, but every so often I run into:</p>
<p>Links to items/entries being relative:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;item&gt;</span>
<span class="w">  </span><span class="nt">&lt;title&gt;</span>On<span class="w"> </span>being<span class="w"> </span>a<span class="w"> </span>staff<span class="w"> </span>engineer<span class="nt">&lt;/title&gt;</span>
<span class="w">  </span><span class="nt">&lt;link&gt;</span>/blog/2022/08/on-being-a-staff-engineer/<span class="nt">&lt;/link&gt;</span>
<span class="nt">&lt;/item&gt;</span>
</code></pre></div>

<p>Top level links (which should be absolute links back to the site) being relative:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;//navoshta.com/&quot;</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;alternate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/html&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>

<p>Other times the link to the parent site is sometimes malformed or refers to the same URL as the feed itself (not the parent site)</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;link&gt;</span>https://snapcraft.io//blog/feed<span class="nt">&lt;/link&gt;</span>
</code></pre></div>

<p>All these are trivially solvable, but something to be aware of nonetheless.</p>
<h2>10. Feeds not respecting ETag and Last-Modified Headers</h2>
<p>Including an ETag or Last-Modified header in the body of a request when
fetching a feed is a mechanism to reduce bandwidth.</p>
<p>There is some great documentation on this topic in a post titled <a href="https://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers">"HTTP Conditional Get for RSS Hackers"</a></p>
<p>Which explains these headers are a way to express:</p>
<blockquote>
<p>“If this document has changed since I last looked at it, give me the new
version. If it hasn't just tell me it hasn't changed and give me nothing.”</p>
</blockquote>
<p>The <a href="https://feedparser.readthedocs.io/en/latest/">feedparser</a> documentation
has a <a href="https://feedparser.readthedocs.io/en/latest/http-etag.html#etag-and-last-modified-headers">good
example</a>
demonstrating this concept. I'll let the following code snippet explain what's
going on:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">feedparser</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;http://feedparser.org/docs/examples/atom10.xml&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">etag</span>
<span class="s1">&#39;&quot;6c132-941-ad7e3080&quot;&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;http://feedparser.org/docs/examples/atom10.xml&#39;</span><span class="p">,</span> <span class="n">etag</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">etag</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">status</span>
<span class="mi">304</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">feed</span>
<span class="p">{}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">entries</span>
<span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">debug_message</span>
<span class="s1">&#39;The feed has not changed since you last checked, so</span>
<span class="n">the</span> <span class="n">server</span> <span class="n">sent</span> <span class="n">no</span> <span class="n">data</span><span class="o">.</span>  <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">feature</span><span class="p">,</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">bug</span><span class="err">!</span><span class="s1">&#39;</span>
</code></pre></div>

<p>This makes it relatively cheap and straightforward to check+update feeds which
adhere to this convention. You simply fan out a bunch of requests and discard
any responses with a <code>304</code> status.</p>
<p>However not all feeds/servers have logic in place to correctly parse/handle
these optional headers. Some feeds will happily return identical content
repeatedly.</p>
<p>If the feed is being polled periodically, but doesn't change on regular basis
this can be wasted computation + bandwidth. When you're polling many feeds in
bulk this can start to add up.</p>
  </article>
</div>
      </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>